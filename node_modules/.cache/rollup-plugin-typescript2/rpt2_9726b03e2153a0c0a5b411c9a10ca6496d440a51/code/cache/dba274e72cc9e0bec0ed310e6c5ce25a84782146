{"code":"export const roleHarvester = {\r\n    run: function (creep) {\r\n        // if harvester went into the wrong room\r\n        if (backRoom(creep) == 0) {\r\n            return;\r\n        }\r\n        if (!creep.memory.harvesting && creep.store[RESOURCE_ENERGY] == 0) {\r\n            creep.memory.harvesting = true;\r\n        }\r\n        else if (creep.memory.harvesting && creep.store.getFreeCapacity() == 0) {\r\n            creep.memory.harvesting = false;\r\n        }\r\n        // if harvester's free capacity more than 0, harvest energy\r\n        if (creep.memory.harvesting) {\r\n            goHarvest(creep);\r\n        }\r\n        else {\r\n            transferEnergy(creep);\r\n        }\r\n    }\r\n};\r\nfunction backRoom(creep) {\r\n    if (creep.room != Game.spawns[\"Spawn1\"].room) {\r\n        creep.moveTo(Game.spawns[\"Spawn1\"]);\r\n        return 0;\r\n    }\r\n    else {\r\n        return -1;\r\n    }\r\n}\r\nfunction goHarvest(creep) {\r\n    let targetSource = Game.getObjectById(creep.memory.sourcesPosition);\r\n    if (targetSource.energy == 0)\r\n        return;\r\n    let container = creep.room.find(FIND_STRUCTURES, { filter: (structure) => structure.structureType == STRUCTURE_CONTAINER &&\r\n            structure.pos.isNearTo(targetSource) });\r\n    if (container[0] != undefined &&\r\n        container[0].store.getFreeCapacity(RESOURCE_ENERGY) == 0 &&\r\n        creep.getActiveBodyparts(CARRY) == 0)\r\n        return;\r\n    if (container[0] != undefined && creep.pos != container[0].pos) {\r\n        creep.moveTo(container[0]);\r\n    }\r\n    if (creep.harvest(targetSource) == ERR_NOT_IN_RANGE) {\r\n        creep.moveTo(targetSource);\r\n    }\r\n}\r\nfunction transferEnergy(creep) {\r\n    let source = Game.getObjectById(creep.memory.sourcesPosition);\r\n    let container = source.pos.findClosestByPath(FIND_STRUCTURES, {\r\n        filter: (structure) => structure.structureType == STRUCTURE_CONTAINER\r\n    });\r\n    if (container != undefined && container.store.getFreeCapacity(RESOURCE_ENERGY) > 0) {\r\n        if (creep.transfer(container, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(container);\r\n        }\r\n        return;\r\n    }\r\n    let structures = creep.room.find(FIND_STRUCTURES, {\r\n        filter: (structure) => {\r\n            return (structure.structureType == STRUCTURE_STORAGE ||\r\n                structure.structureType == STRUCTURE_CONTAINER ||\r\n                structure.structureType == STRUCTURE_EXTENSION ||\r\n                structure.structureType == STRUCTURE_SPAWN ||\r\n                structure.structureType == STRUCTURE_TOWER)\r\n                && structure.store.getFreeCapacity(RESOURCE_ENERGY) > 0;\r\n        }\r\n    });\r\n    let transferTo = structures.filter(structure => structure.structureType == STRUCTURE_EXTENSION);\r\n    let target;\r\n    if (transferTo[0] == undefined) {\r\n        target = creep.pos.findClosestByPath(structures);\r\n    }\r\n    else {\r\n        target = creep.pos.findClosestByPath(transferTo);\r\n    }\r\n    if (creep.transfer(target, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n        creep.moveTo(target);\r\n    }\r\n}\r\n//# sourceMappingURL=RoleHarvester.js.map","references":[],"map":"{\"version\":3,\"file\":\"RoleHarvester.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/Role/RoleHarvester.ts\"],\"names\":[],\"mappings\":\"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\"}"}
