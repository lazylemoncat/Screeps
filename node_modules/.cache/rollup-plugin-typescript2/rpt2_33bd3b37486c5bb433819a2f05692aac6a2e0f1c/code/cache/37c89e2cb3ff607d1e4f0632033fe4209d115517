{"code":"import { tasks } from \"../Tasks/Tasks\";\r\nexport const roleHarvester = {\r\n    run: function (creep, room) {\r\n        let transfered = false;\r\n        if (creep.store.getFreeCapacity() < creep.getActiveBodyparts(WORK) * 2) {\r\n            transfered = transferEnergy(creep, room);\r\n        }\r\n        goHarvest(creep, transfered, room);\r\n    }\r\n};\r\nfunction goHarvest(creep, transfered, room) {\r\n    let source = Game.getObjectById(room.sources[creep.memory.sourcesPosition]);\r\n    if (!creep.pos.isNearTo(source)) {\r\n        creep.moveTo(source);\r\n        return;\r\n    }\r\n    if (source.energy == 0 ||\r\n        creep.store.getFreeCapacity(RESOURCE_ENERGY) == 0 && !transfered) {\r\n        return;\r\n    }\r\n    let container = source.pos.findInRange(FIND_STRUCTURES, 1).\r\n        filter(structure => structure.structureType == STRUCTURE_CONTAINER);\r\n    if (container[0] != undefined) {\r\n        if (!creep.pos.isEqualTo(container[0])) {\r\n            creep.moveTo(container[0]);\r\n        }\r\n    }\r\n    creep.harvest(source);\r\n}\r\nfunction transferEnergy(creep, room) {\r\n    if (Game.getObjectById(creep.memory.waiting) != null) {\r\n        return;\r\n    }\r\n    let links = room.links;\r\n    let containers = room.containers;\r\n    let sources = room.sources;\r\n    if (links.length == 0 && containers.length < sources.length &&\r\n        creep.pos.findInRange(FIND_STRUCTURES, 1).filter(structure => structure.structureType == STRUCTURE_CONTAINER).length == 0) {\r\n        if (!tasks.withdraw.creep.includes(creep.id)) {\r\n            tasks.withdraw.creep.push(creep.id);\r\n        }\r\n        return false;\r\n    }\r\n    if (!transfer(creep)) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\nfunction transfer(creep) {\r\n    let link = creep.pos.findInRange(FIND_STRUCTURES, 1).filter(structure => structure.structureType == STRUCTURE_LINK)[0];\r\n    if (link != undefined) {\r\n        let targetLink = Game.getObjectById(link.id);\r\n        if (creep.transfer(targetLink, RESOURCE_ENERGY) == OK) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    let container = creep.pos.findInRange(FIND_STRUCTURES, 1).filter(structure => structure.structureType == STRUCTURE_CONTAINER)[0];\r\n    if (container != undefined) {\r\n        if (creep.transfer(container, RESOURCE_ENERGY) == OK) {\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n//# sourceMappingURL=RoleHarvester.js.map","references":["D:/Desktop/ScreepsCodes/World/src/Tasks/Tasks.ts"],"map":"{\"version\":3,\"file\":\"RoleHarvester.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/Role/RoleHarvester.ts\"],\"names\":[],\"mappings\":\"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\"}"}
