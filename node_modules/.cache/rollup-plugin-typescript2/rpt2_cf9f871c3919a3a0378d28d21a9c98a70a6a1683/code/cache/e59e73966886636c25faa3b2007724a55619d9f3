{"code":"import { tasks } from \"../Tasks/Tasks\";\r\nimport { globalStructure } from \"../global/GlobalStructure\";\r\nexport const roleHarvester = {\r\n    run: function (creep) {\r\n        let transfered = false;\r\n        if (creep.store.getFreeCapacity() < creep.getActiveBodyparts(WORK) * 2) {\r\n            transfered = transferEnergy(creep);\r\n        }\r\n        goHarvest(creep, transfered);\r\n    }\r\n};\r\nfunction goHarvest(creep, transfered) {\r\n    let source = globalStructure.sources[creep.memory.sourcesPosition];\r\n    if (!creep.pos.isNearTo(source)) {\r\n        creep.moveTo(source);\r\n        return;\r\n    }\r\n    if (source.energy == 0 ||\r\n        creep.store.getFreeCapacity(RESOURCE_ENERGY) == 0 && !transfered) {\r\n        return;\r\n    }\r\n    let container = source.pos.findInRange(globalStructure.containers, 1);\r\n    if (container[0] != undefined) {\r\n        if (!creep.pos.isEqualTo(container[0])) {\r\n            creep.moveTo(container[0]);\r\n        }\r\n    }\r\n    creep.harvest(source);\r\n}\r\nfunction transferEnergy(creep) {\r\n    if (Game.getObjectById(creep.memory.waiting) != null) {\r\n        return;\r\n    }\r\n    let links = globalStructure.links;\r\n    let containers = globalStructure.containers;\r\n    let sources = globalStructure.sources;\r\n    if (links.length == 0 && containers.length < sources.length &&\r\n        creep.pos.findInRange(containers, 1).length == 0) {\r\n        if (!tasks.withdrawTasks.includes(creep.id)) {\r\n            tasks.withdrawTasks.push(creep.id);\r\n        }\r\n        // creep.transferTo(creep);\r\n        return false;\r\n    }\r\n    if (!transfer(creep)) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\nfunction transfer(creep) {\r\n    let link = creep.pos.findInRange(globalStructure.fromLinks, 1)[0];\r\n    if (link != undefined) {\r\n        let targetLink = Game.getObjectById(link.id);\r\n        if (creep.transfer(targetLink, RESOURCE_ENERGY) == OK) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    let source = globalStructure.sources[creep.memory.sourcesPosition];\r\n    let container = globalStructure.containers.filter(structure => structure.pos.isNearTo(source))[0];\r\n    if (container != undefined) {\r\n        if (creep.transfer(container, RESOURCE_ENERGY) == OK) {\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n//# sourceMappingURL=RoleHarvester.js.map","references":["D:/Desktop/ScreepsCodes/World/src/Tasks/Tasks.ts","D:/Desktop/ScreepsCodes/World/src/global/GlobalStructure.ts"],"map":"{\"version\":3,\"file\":\"RoleHarvester.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/Role/RoleHarvester.ts\"],\"names\":[],\"mappings\":\"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\"}"}
